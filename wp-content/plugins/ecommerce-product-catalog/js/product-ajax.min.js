/*!
 impleCode Product AJAX Scripts
 Manages product ajax related scripts
 (c) 2021 impleCode - https://implecode.com
 */
var ic_popstate=false;var ic_product_list="";var ic_filters_bar="";jQuery(document).ready(function(){ic_product_list=jQuery(".product-list").first();ic_filters_bar=jQuery(".product-sort-bar").first();if(jQuery(".product-list").length!==1&&ic_filters_bar.length===0){return true}var t=jQuery.ic.applyFilters("ic_ajax_submit_elements","form.ic_ajax, form.product_order, .product-sort-bar form#product_search_form, form.price-filter-form");jQuery("body").on("change",".product-search-box",function(){var t=jQuery(this).val();jQuery(".ic-search-keyword").text(t);jQuery(".product-search-box").val(t)});jQuery("body").on("submit",t,function(t){var r=jQuery(this);var i=r.closest(".product-sort-bar");if(i.length){ic_filters_bar=i;ic_product_list=i.nextAll(".product-list").first()}if(!ic_ajax_product_list_on_screen()){return true}t.preventDefault();var e="";e=jQuery("[name!=page]",this);var a=r.serialize();var c="";if(r.data("ic_ajax")==="page"){c=c+"page/"+r.find("[name=page]").val()}var o=e.serialize();if(o){c=c+"?"+o}var s=r.attr("action");if(c!==""){if(s.slice(-1)!=="/"&&r.data("ic_ajax")==="page"){s=s+"/"}c=s+c}else{c=s}var l="";if(r.hasClass("product_order")){l="product_order"}ic_ajax_update_product_listing(a,c,l)});var r="a.filter-url, .product-archive-nav li:not(.active) a, a.price-filter-link";jQuery("body").on("click",r,function(t){var r=jQuery(this);var i=r.closest(".product-sort-bar");if(i.length){ic_filters_bar=i;ic_product_list=i.nextAll(".product-list").first()}if(!ic_ajax_product_list_on_screen()){return true}t.preventDefault();var e=r.attr("href");var a="";if(e.indexOf("?")!==-1){a=e.substr(e.indexOf("?")+1)}var c=false;var o="";if(r.closest("li").data("page")!==undefined){o=r.closest("li").data("page")}else if(r.data("page")!==undefined){o=r.data("page")}if(o!==""){if(a!==""){a=a+"&page="+o}else{a=a+"page="+o}c=r.attr("href")}ic_ajax_update_product_listing(a,c)});if(jQuery(t).length||jQuery(r).length){ic_ajax_back_button_filters()}});function ic_ajax_update_product_listing(t,o,i){i=typeof i!=="undefined"?i:"";o=ic_defaultFor(o,false);if(o===false){o="?"+t}if(o!=="none"){window.history.pushState({form_data:t},document.title,o);ic_popstate=true}if(ic_product_list===""){ic_product_list=jQuery(".product-list").first()}if(ic_filters_bar===""){ic_filters_bar=jQuery(".product-sort-bar").first()}var r=ic_ajax.query_vars;var e=0;if(ic_product_list.data("ic_ajax_query")){r=JSON.stringify(ic_product_list.data("ic_ajax_query"));e=1}var s={action:"ic_self_submit",self_submit_data:t,query_vars:r,request_url:ic_ajax.request_url,ajax_elements:{},ic_shortcode:e,is_search:ic_ajax.is_search,security:ic_ajax.nonce};jQuery.ic.doAction("ic_self_submit_before");var a=jQuery(".ic_ajax").not(".product-sort-bar .ic_ajax");if(ic_filters_bar.length&&i===""){s["ajax_elements"]["product-sort-bar"]=1;a.add(ic_filters_bar.find(".ic_ajax"))}if(a.length){a.each(function(){if(jQuery(this).data("ic_ajax").length){var t=jQuery(this).data("ic_ajax");if(i===""||i===t){var r=jQuery(this).data("ic_ajax_data");if(!r){r=1}if(s["ajax_elements"][t]===undefined){if(s["ajax_elements"]["product-sort-bar"]===undefined){s["ajax_elements"][t]=r}else if(!jQuery(this).closest(".product-sort-bar").length){s["ajax_elements"][t]=r}}}}})}ic_product_list.css("opacity","0.5");jQuery.post(product_object.ajaxurl,s).done(function(c){jQuery(".reset-filters").remove();try{c=JSON.parse(c)}catch(t){location.reload();return false}if(!c){location.reload();return false}if(c["redirect"]){var t=new URL(c["redirect"]);if(t.host===window.location.host){window.location.replace(c["redirect"])}else{location.reload()}return false}var r=jQuery(c["product-listing"]).not("form, div.product-sort-bar, .reset-filters");ic_product_list.animate({opacity:0},"fast",function(){r=r.hide();jQuery(".product-list").removeClass("active-product-listing");r.addClass("active-product-listing");ic_product_list.replaceWith(r);ic_product_list=jQuery(".product-list.active-product-listing");ic_product_list.fadeIn("fast");setTimeout(modern_grid_font_size(),0);if(!is_element_visible(ic_product_list.find("div:first-child"))){if(ic_product_list.find("div").length){jQuery("html, body").animate({scrollTop:ic_product_list.find("div").offset().top-100},"slow")}}});if(jQuery(".product-archive-nav").length){jQuery(".product-archive-nav").replaceWith(c["product-pagination"])}else if(jQuery("div#product_sidebar").length){jQuery(c["product-pagination"]).insertAfter("div#product_sidebar")}else if(jQuery("article#product_listing").length){jQuery(c["product-pagination"]).insertAfter("article#product_listing")}else{ic_product_list.after(c["product-pagination"])}jQuery.each(s["ajax_elements"],function(t,r){var i=jQuery();if(t!=="product-sort-bar"){i=jQuery(":not(.product-sort-bar ) ."+t)}if(ic_filters_bar.length){if(t==="product-sort-bar"){i=ic_filters_bar}else{i.add(ic_filters_bar.find("."+t))}}if(i.length&&c[t]!==undefined){var e=jQuery(c[t]);var a=false;if(e.hasClass("ic-empty-filter")){a=true}if(!e.hasClass(t)){e=e.find("."+t)}if(e.length){i.replaceWith(e)}else{i.html("");a=true}if(a){i.closest(".widget").addClass("ic-empty-filter")}else{i.closest(".widget").removeClass("ic-empty-filter")}i.trigger("reload");if(t==="product-sort-bar"){ic_filters_bar=jQuery(".product-sort-bar").first()}}});if(c["remove_pagination"]){var i=ic_ajax.request_url;if(i.indexOf("?")!==-1){i=i.substr(0,i.indexOf("?"))}var e="";if(o.indexOf("?")!==-1){e=o.substr(o.indexOf("?")+1)}if(e!==""){e="?"+e}var a=i+e;window.history.replaceState({},document.title,a)}jQuery.ic.doAction("ic_self_submit")}).fail(function(){location.reload()})}function ic_ajax_back_button_filters(){jQuery(window).off("popstate",ic_ajax_run_filters);jQuery(window).on("popstate",ic_ajax_run_filters)}function ic_ajax_run_filters(t){var r=t.originalEvent.state;if(r!==null){if(r.form_data!==undefined){var i=r.form_data;if(i.length){ic_ajax_update_product_listing(i,"none")}else{window.location.reload()}}}else if(ic_popstate){location.reload()}}function ic_ajax_product_list_on_screen(){if(ic_product_list===""){ic_product_list=jQuery(".product-list").first()}if(jQuery(window).scrollTop()+jQuery(window).height()>ic_product_list.offset().top){return true}return false}